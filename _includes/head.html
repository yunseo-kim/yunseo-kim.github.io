<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  <meta http-equiv="Content-Language" content="{{site.active_lang}}">

  {% if jekyll.environment == 'production' -%}
    <!-- Google Analytics -->
    {% if site.analytics.google.id and site.analytics.google.id != empty -%}
      {% include analytics/google.html %}
    {%- endif %}
  {%- endif %}

  {% if site.default_lang -%}
  <link rel="alternate" hreflang="{{site.default_lang}}" href="{{site.url}}{{page.url}}" />
  {%- endif -%}
  {% for lang in site.languages -%}
    {% if lang == site.default_lang -%}
      {%- continue -%}
    {%- endif %}
  <link rel="alternate" hreflang="{{lang}}" href="{{site.url}}/{{lang}}{{page.url}}" />
  {%- endfor %}

  {% capture seo_tags -%}
    {% seo title=false %}
  {%- endcapture %}

  <!-- Setup Open Graph image -->

  {% if page.image -%}
    {% assign src = page.image.path | default: page.image %}

    {% unless src contains '://' -%}
      {%- capture img_url -%}
        {% include media-url.html src=src subpath=page.media_subpath absolute=true %}
      {%- endcapture -%}

      {%- capture old_url -%}{{ src | absolute_url }}{%- endcapture -%}
      {%- capture new_url -%}{{ img_url }}{%- endcapture -%}

      {% assign seo_tags = seo_tags | replace: old_url, new_url %}
    {%- endunless %}

  {% elsif site.social_preview_image %}
    {%- capture img_url -%}
      {% include media-url.html src=site.social_preview_image absolute=true %}
    {%- endcapture -%}

    {%- capture og_image -%}
      <meta property="og:image" content="{{ img_url }}" />
    {%- endcapture -%}

    {%- capture twitter_image -%}
      <meta name="twitter:card" content="summary_large_image" />
      <meta property="twitter:image" content="{{ img_url }}" />
    {%- endcapture -%}

    {% assign old_meta_clip = '<meta name="twitter:card" content="summary" />' %}
    {% assign new_meta_clip = og_image | append: twitter_image %}
    {% assign seo_tags = seo_tags | replace: old_meta_clip, new_meta_clip %}
  {% endif %}

  {%- capture old_og_locale -%}
    <meta property="og:locale" content="{{site.lang}}" />
  {%- endcapture -%}
  {%- capture new_og_locale -%}
    <meta property="og:locale" content="{{site.active_lang}}" />
    {% for lang in site.languages -%}
      {%- if lang == site.active_lang -%}
        {%- continue -%}
      {%- endif %}
    <meta property="og:locale:alternate" content="{{lang}}" />
    {%- endfor %}
  {%- endcapture -%}
  {% assign seo_tags = seo_tags | replace: old_og_locale, new_og_locale %}
  
  {% unless site.active_lang == site.default_lang -%}
    {%- capture old_canonical_link -%}
      <link rel="canonical" href="{{site.url}}{{page.url}}" />
    {%- endcapture -%}
    {%- capture old_og_url -%}
      <meta property="og:url" content="{{site.url}}{{page.url}}" />
    {%- endcapture -%}
    {%- capture new_canonical_link -%}
      <link rel="canonical" href="{{site.url}}/{{site.active_lang}}{{page.url}}" />
    {%- endcapture -%}
    {%- capture new_og_url -%}
      <meta property="og:url" content="{{site.url}}/{{site.active_lang}}{{page.url}}" />
    {%- endcapture -%}
    {% assign seo_tags = seo_tags | replace: old_canonical_link, new_canonical_link %}
    {% assign seo_tags = seo_tags | replace: old_og_url, new_og_url %}
  {%- endunless %}

  {{ seo_tags }}

  <title>
    {%- unless page.layout == 'home' -%}
      {{ page.title | append: ' | ' }}
    {%- endunless -%}
    {{ site.title }}
  </title>

  {% include_cached favicons.html %}

  <!-- Resource Hints -->
  {% unless site.assets.self_host.enabled -%}
    {% for hint in site.data.origin.cors.resource_hints %}
      {% for link in hint.links %}
        <link rel="{{ link.rel }}" href="{{ hint.url }}" {{ link.opts | join: ' ' }}>
      {% endfor %}
    {% endfor %}
  {% endunless %}

  <!-- Bootstrap -->
  {% unless jekyll.environment == 'production' -%}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  {%- endunless %}

  <!-- Theme style -->
  <link rel="stylesheet" href="{{ '/assets/css/shared.css' | relative_url }}">
  {% case page.layout -%}
    {%- when "archives" -%}
      <link rel="stylesheet" href="{{ '/assets/css/archives.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/post.css' | relative_url }}">
    {%- when "categories" -%}
      <link rel="stylesheet" href="{{ '/assets/css/categories.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/category-tag.css' | relative_url }}">
    {%- when "home" -%}
      <link rel="stylesheet" href="{{ '/assets/css/home.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/post.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/archives.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/categories.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/tags.css' | relative_url }}">
    {%- when "post" -%}
      <link rel="stylesheet" href="{{ '/assets/css/post.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/home.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/archives.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/categories.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/tags.css' | relative_url }}">
    {%- when "tags" -%}
      <link rel="stylesheet" href="{{ '/assets/css/tags.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/category-tag.css' | relative_url }}">
    {%- when "category", "tag" -%}
      <link rel="stylesheet" href="{{ '/assets/css/category-tag.css' | relative_url }}">
      <link rel="prefetch" href="{{ '/assets/css/post.css' | relative_url }}">
  {% endcase %}

  <!-- Web Font -->
  <link rel="stylesheet" href="{{ site.data.origin[type].webfonts | relative_url }}">
  {% if site.active_lang == 'ko' -%}
    <link rel="preload" as="style" crossorigin="anonymous" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
    <link rel="stylesheet" as="style" type="text/css" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
  {%- elsif site.active_lang == 'ja' or site.active_lang == 'zh-TW' -%}
    <link rel="preload" as="style" crossorigin="anonymous" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-jp-dynamic-subset.min.css">
    <link rel="stylesheet" as="style" type="text/css" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-jp-dynamic-subset.min.css" />
  {%- else -%}
    <link rel="preload" as="style" crossorigin="anonymous" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-std-dynamic-subset.min.css">
    <link rel="stylesheet" as="style" type="text/css" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-std-dynamic-subset.min.css" />
  {%- endif %}
  {% if site.active_lang == 'zh-TW' -%}
    <style>
      body {
        font-feature-settings: "ss05";
      }
    </style>
  {%- endif %}

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="{{ site.data.origin[type].fontawesome.css | relative_url }}">

  <!-- 3rd-party Dependencies -->

  {% if site.toc and page.toc -%}
    <link rel="stylesheet" href="{{ site.data.origin[type].toc.css | relative_url }}">
  {%- endif %}

  {% if page.layout == 'page' or page.layout == 'post' -%}
    <!-- Image Popup -->
  <link rel="stylesheet" href="{{ site.data.origin[type].glightbox.css | relative_url }}">
  {%- endif %}

  <!-- Scripts -->

  <script src="{{ '/assets/js/dist/theme.min.js' | relative_url }}"></script>

  {% include js-selector.html lang=lang %}

  {% if jekyll.environment == 'production' -%}
    <!-- PWA -->
    {% if site.pwa.enabled -%}
      <script
        defer
        src="{{ '/app.min.js' | relative_url }}?baseurl={{ site.baseurl | default: '' }}&register={{ site.pwa.cache.enabled }}"
      ></script>
    {%- endif %}

    <!-- Web Analytics other than Google Analytics -->
    {% for analytics in site.analytics -%}
      {% capture str %}{{ analytics }}{% endcapture %}
      {% assign platform = str | split: '{' | first %}
      {% if platform == "google" -%}
        {%- continue -%}
      {%- endif %}
      {% if site.analytics[platform].id and site.analytics[platform].id != empty -%}
        {% include analytics/{{ platform }}.html %}
      {%- endif %}
    {%- endfor %}

    <!-- Session Recordings -->
    {% for session_recordings in site.session_recordings -%}
      {% capture str %}{{ session_recordings }}{% endcapture %}
      {% assign platform = str | split: '{' | first %}
      {% if site.session_recordings[platform].id and site.session_recordings[platform].id != empty -%}
        {% include session-recordings/{{ platform }}.html %}
      {%- endif %}
    {%- endfor %}

    <!-- Ad Network Integrations -->
    {% if site.ad_networks -%}
      {% if site.ad_networks.adsense and site.ad_networks.adsense != empty -%}
        {% include ad-networks/adsense.html %}
      {%- endif %}
    {%- endif %}
  {% endif %}

  {% include metadata-hook.html %}
</head>